\section{整体设计}
\subsection{CPU整体设计}
本实验实现了基于标准32位MIPS指令集的子集的五级流水CPU，支持异常、中断、TLB等。

MIPS指令集的各条指令可以分解为取指（IF）、译码（ID）、执行（EX）、访存（MEM）和回写（WB）五个阶段，分别对应于本次实验需要实现的五个核心模块。模块内部采用组合逻辑电路实现，相邻模块之间的数据传输采用时序逻辑电路实现，每经过一个时钟周期，所有阶段分别将各自保存的结果交给下一个阶段，从而实现流水CPU。

此外，我们还实现了寄存器堆模块（Regfile）、HILO模块（HILO）、协处理器模块（CP0）和控制模块（CTRL）。寄存器堆模块在译码阶段实现，便于指令在译码阶段访问寄存器并得到相应的数据。HILO模块和协处理器模块在回写阶段实现。控制模块则用于控制整个流水线的暂停、清除等动作，因此不将其归入流水线中的某一个阶段。

数据通路图如下。

（数据通路图）

流水线虽然能提高指令执行效率，但由此带来的冲突是不可避免的。我们对于流水线三种类型的冲突（结构冲突、数据冲突和控制冲突）分别进行了处理。
\begin{enumerate}
	\item 结构冲突
	
	指令在重叠执行过程中发生硬件资源冲突，在MIPS架构中主要是指取指阶段和访存阶段同时对存储器进行访问引起的冲突。解决方法是在设计数据通路时，采用资源重复设置的方法。如果指令和数据放在同一个存储器，可使用双端口存储器，一个端口存取数据，另一个端口取指令，这两个操作可以并行操作而不引起结构冲突。
	
	\item 数据冲突
	
	在同时重叠执行的几条指令中，一条指令依赖于前面指令执行结果，但是得不到执行结果造成的冲突（RAW，即Read After Write）。解决方法是在数据通路中加入流水线暂停和恢复机制（load相关），并引入数据前推技术，将执行结果提前送到其他模块，以供其他模块参考和使用。由于编译器调度容易出错，所以本项目中不在编译器上做优化。
	
	\item 控制冲突
	
	流水线中的分支指令或者其他需要改写PC的指令造成的冲突。解决方法是引入延时槽机制，这要求编译器在分支指令后插入空指令，对流水线的性能有一定的影响。
	
\end{enumerate}
\subsection{元件例化}
\subsection{状态机}
\subsection{异常处理}